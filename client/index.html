<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Driftz IO</title>
  <link rel="icon" type="image/png" href="favicon.png" />
  <link rel="stylesheet" href="style.css" />
  <!-- Socket.io client -->
  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
</head>
<body>
  <!-- Top Toolbar (Hover-Activated) -->
  <div id="toolbarHoverZone" class="toolbar-hover-zone"></div>
  <div id="topToolbar" class="top-toolbar">
    <div class="toolbar-left">
      <span id="toolbarPlayerName" class="toolbar-player-name"></span>
    </div>
    <div class="toolbar-right">
      <button id="toolbarLogoutBtn" class="toolbar-logout-btn" title="Logout">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
          <polyline points="16,17 21,12 16,7"></polyline>
          <line x1="21" y1="12" x2="9" y2="12"></line>
        </svg>
      </button>
      <button id="toolbarSettingsBtn" class="toolbar-settings-btn" title="Settings">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="3"></circle>
          <path d="M12 1v6m0 8v6M4.22 4.22l4.24 4.24m8.48 8.48l4.24 4.24M1 12h6m8 0h6M4.22 19.78l4.24-4.24m8.48-8.48l4.24-4.24"></path>
        </svg>
      </button>
    </div>
  </div>

  <!-- Authentication Screen (Pre-Menu) -->
  <div id="authScreen" class="auth-screen overlay">
    <div class="auth-container">
      <h1 class="auth-title">DRIFTZ.IO</h1>
      
      <!-- Login/Register Selection -->
      <div id="authSelection" class="auth-selection">
        <div class="auth-option">
          <button id="showLoginBtn" class="auth-option-btn">Login</button>
        </div>
        <div class="auth-option">
          <button id="showRegisterBtn" class="auth-option-btn">Register</button>
        </div>
        <div class="auth-option">
          <button id="showGuestBtn" class="auth-option-btn">Play as Guest</button>
        </div>
      </div>

      <!-- Login Form -->
      <div id="loginForm" class="auth-form hidden">
        <div class="auth-form-header">
          <h2 class="auth-form-title">Login</h2>
          <button id="backFromLoginBtn" class="auth-back-btn">Back</button>
        </div>
        <form id="loginFormElement" class="auth-form-content">
          <div class="auth-input-group">
            <label class="auth-label">Email</label>
            <input type="email" id="loginEmail" class="auth-input" required>
          </div>
          <div class="auth-input-group">
            <label class="auth-label">Password</label>
            <input type="password" id="loginPassword" class="auth-input" required>
          </div>
          <div id="loginError" class="auth-error hidden"></div>
          <button type="submit" class="auth-submit-btn">Login</button>
        </form>
      </div>

      <!-- Register Form -->
      <div id="registerForm" class="auth-form hidden">
        <div class="auth-form-header">
          <h2 class="auth-form-title">Register</h2>
          <button id="backFromRegisterBtn" class="auth-back-btn">Back</button>
        </div>
        <form id="registerFormElement" class="auth-form-content">
          <div class="auth-input-group">
            <label class="auth-label">Username</label>
            <input type="text" id="registerUsername" class="auth-input" maxlength="20" required>
          </div>
          <div class="auth-input-group">
            <label class="auth-label">Email</label>
            <input type="email" id="registerEmail" class="auth-input" required>
          </div>
          <div class="auth-input-group">
            <label class="auth-label">Password</label>
            <input type="password" id="registerPassword" class="auth-input" required>
          </div>
          <div id="registerError" class="auth-error hidden"></div>
          <button type="submit" class="auth-submit-btn">Register</button>
        </form>
      </div>

      <!-- Guest Form -->
      <div id="guestForm" class="auth-form hidden">
        <div class="auth-form-header">
          <h2 class="auth-form-title">Guest</h2>
          <button id="backFromGuestBtn" class="auth-back-btn">Back</button>
        </div>
        <form id="guestFormElement" class="auth-form-content">
          <div class="auth-input-group">
            <input type="text" id="guestName" class="auth-input" placeholder="Name" maxlength="20" required>
          </div>
          <div id="guestError" class="auth-error hidden"></div>
          <button type="submit" class="auth-submit-btn">Continue</button>
        </form>
      </div>

      <!-- Loading State -->
      <div id="authLoading" class="auth-loading hidden">
        <div class="auth-spinner"></div>
        <div class="auth-loading-text">Please wait...</div>
      </div>
    </div>
  </div>

  <div id="menu" class="overlay hidden">
    <h1 class="title">DRIFTZ.IO</h1>
    <div id="carSelector" class="car-selector">
      <button id="switchButton" class="nav-button prev-button">ðŸ—˜</button>
      <div id="carCard" class="single-car-card">
        <input type="radio" name="car" value="" checked style="display: none;" />
        <div class="car-header">
          <div id="carName" class="car-name"></div>
          <div class="car-visual">
            <svg id="carShape" class="car-shape" width="60" height="60" viewBox="-30 -30 60 60">
              <polygon id="carPolygon" points="" fill="" stroke="" stroke-width="2" />
            </svg>
          </div>
        </div>
        <div class="car-stats">
          <div class="stat-item">
            <div class="stat-label">Speed</div>
            <div class="stat-bar">
              <div id="speedFill" class="stat-fill health" style="width: 0%"></div>
            </div>
          </div>
          <div class="stat-item">
            <div class="stat-label">Durability</div>
            <div class="stat-bar">
              <div id="healthFill" class="stat-fill regen" style="width: 0%"></div>
            </div>
          </div>
          <div class="stat-item">
            <div class="stat-label">Handling</div>
            <div class="stat-bar">
              <div id="handlingFill" class="stat-fill speed" style="width: 0%"></div>
            </div>
          </div>
        </div>
      </div>
      <button id="joinButton" class="nav-button play-button">âž¤</button>
    </div>
    
    <!-- Room Browser Button -->
    <button id="roomBrowserButton" class="room-browser-button">Browse Rooms</button>

    <!-- Map Editor Button -->
    <button id="mapEditorButton" class="map-editor-button">Map Editor</button>
  </div>

  <canvas id="spectatorCanvas" class="spectator-canvas"></canvas>
  <canvas id="gameCanvas"></canvas>

  <!-- Kill Feed -->
  <div id="killFeed" class="kill-feed hidden">
    <!-- Dynamic kill feed messages will appear here -->
  </div>

  <!-- Mini Leaderboard (Always Visible) -->
  <div id="miniLeaderboard" class="mini-leaderboard">
    <div class="mini-leaderboard-header">Leaderboard</div>
    <div class="mini-leaderboard-content">
      <!-- Dynamic player entries -->
    </div>
  </div>

  <!-- Performance Overlays -->
  <div id="performanceOverlay" class="performance-overlay hidden">
    <div id="fpsDisplay" class="fps-display hidden">FPS: --</div>
    <div id="pingDisplay" class="ping-display hidden">Ping: --ms</div>
  </div>

  <!-- HUD -->
  <div id="hud">
    <!-- Upgrade points HUD removed - now displayed beside upgrade cards -->
  </div>

  <div id="message" class="hidden"></div>

  <!-- Upgrade Cards Container -->
  <div id="upgradeCards" class="upgrade-cards-container hidden">
    <!-- Dynamic upgrade cards will be generated here -->
  </div>

  <!-- Ability HUD -->
  <div id="abilityHud" class="ability-hud hidden">
    <div class="ability-progress-bg"></div>
    <span id="abilityName" class="ability-name">Dash</span>
    <span class="ability-hint">(Space)</span>
  </div>

  <!-- Lap Counter -->
  <div id="lapCounter" class="lap-counter hidden">
    <span id="laps">Laps: 0</span>
  </div>

  <!-- Lap Timer -->
  <div id="lapTimer" class="lap-timer hidden">
    <div class="lap-timer-current">
      <span class="lap-timer-label">Current</span>
      <span id="currentLapTime" class="lap-timer-time">0:00.000</span>
    </div>
    <div class="lap-timer-best">
      <span class="lap-timer-label">Best</span>
      <span id="bestLapTime" class="lap-timer-time"></span>
    </div>
  </div>

  <!-- Boost Display -->
  <div id="boostDisplay" class="boost-display hidden">
    <span class="boost-label">Boost</span>
    <div class="boost-bar-container">
      <div id="boostBar" class="boost-bar"></div>
    </div>
    <span id="boostText" class="boost-text">100/100</span>
  </div>

  <!-- Loading Screen Template -->
  <div id="loadingScreen" class="overlay loading-overlay hidden">
    <div class="loading-content">
      <div class="game-title">DRIFTOUT2</div>
      <div class="loading-spinner"></div>
      <div class="loading-text">Connecting to server...</div>
      <div class="loading-subtext">Waiting for game data</div>
    </div>
  </div>

  <!-- Disconnection Overlay Template -->
  <div id="disconnectionOverlay" class="overlay disconnect-overlay hidden">
    <div class="disconnect-content">
      <div class="disconnect-title">DISCONNECTED</div>
      <div class="disconnect-message">Unable to connect to game server</div>
      <div class="disconnect-details">
        The connection has been lost. This can happen due to:<br>
        â€¢ Network connectivity issues<br>
        â€¢ Server maintenance or restart<br>
        â€¢ Browser sleeping inactive tabs
      </div>
      <button id="disconnectRefreshBtn" class="disconnect-refresh-btn">CLICK TO REFRESH</button>
    </div>
  </div>

  <!-- Menu Disconnection Warning Template -->
  <div id="menuDisconnectionWarning" class="menu-warning hidden">
    <div class="warning-title">DISCONNECTED</div>
    <div class="warning-message">Unable to connect to game server</div>
    <div class="warning-details">
      The connection has been lost. This can happen due to:<br>
      â€¢ Network connectivity issues<br>
      â€¢ Server maintenance or restart<br>
      â€¢ Browser sleeping inactive tabs
    </div>
    <button id="menuRefreshBtn" class="menu-refresh-btn">CLICK TO REFRESH</button>
  </div>

  <!-- Settings Modal -->
  <div id="settingsModal" class="settings-modal hidden">
    <div class="settings-content">
      <div class="settings-header">
        <h2 class="settings-title">Settings</h2>
        <button id="settingsCloseBtn" class="settings-close-btn">Ã—</button>
      </div>
      
      <div class="settings-body">
        <!-- Graphics Section -->
        <div class="settings-section">
          <h3 class="settings-section-title">Graphics</h3>
          <div class="settings-row">
            <label class="settings-label">FPS Counter</label>
            <div class="toggle-switch">
              <input type="checkbox" id="fpsToggle" class="toggle-input">
              <span class="toggle-slider"></span>
            </div>
          </div>
          <div class="settings-row">
            <label class="settings-label">Ping Display</label>
            <div class="toggle-switch">
              <input type="checkbox" id="pingToggle" class="toggle-input">
              <span class="toggle-slider"></span>
            </div>
          </div>
        </div>

        <!-- Performance Section (placeholder) -->
        <div class="settings-section">
          <h3 class="settings-section-title">Performance</h3>
          <div class="settings-placeholder">
            Additional performance settings will be added here
          </div>
        </div>

        <!-- Audio Section (placeholder) -->
        <div class="settings-section">
          <h3 class="settings-section-title">Audio</h3>
          <div class="settings-placeholder">
            Audio settings will be added here
          </div>
        </div>

        <!-- Controls Section (placeholder) -->
        <div class="settings-section">
          <h3 class="settings-section-title">Controls</h3>
          <div class="settings-placeholder">
            Control customization will be added here
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Detailed Leaderboard Modal -->
  <div id="detailedLeaderboard" class="detailed-leaderboard-modal hidden">
    <div class="detailed-leaderboard-content">
      <div class="detailed-leaderboard-header">
        <h2 class="leaderboard-title">Race Statistics</h2>
        <div class="leaderboard-hint">Press TAB or ESC to close</div>
      </div>
      <table class="leaderboard-table">
        <thead>
          <tr>
            <th>Rank</th>
            <th>Player</th>
            <th>Laps</th>
            <th>Kills</th>
            <th>Deaths</th>
            <th>K/D</th>
            <th>Best Lap</th>
          </tr>
        </thead>
        <tbody id="leaderboardTableBody">
          <!-- Dynamic rows -->
        </tbody>
      </table>
    </div>
  </div>

  <!-- Room Browser Modal -->
  <div id="roomBrowserModal" class="room-browser-modal hidden">
    <div class="room-browser-content">
      <div class="room-browser-header">
        <h2 class="room-browser-title">Browse Rooms</h2>
        <button id="roomBrowserCloseBtn" class="room-browser-close-btn">Ã—</button>
      </div>
      
      <div class="room-browser-body">       
        <!-- Room List Section -->
        <div class="room-browser-section">
          <div class="section-header">
            <h3 class="section-title">Rooms</h3>
            <button id="refreshRoomsButton" class="refresh-button">Refresh</button>
          </div>
          <div id="roomsList" class="rooms-list">
            <div class="loading-message">Loading rooms...</div>
          </div>
        </div>
        
        <!-- Create Room Section -->
        <div class="room-browser-section">
          <h3 class="section-title">Create New Room</h3>
          <div class="create-room-form">
            <div class="form-row">
              <label class="form-label">Room Name</label>
              <input type="text" id="createRoomName" class="form-input" placeholder="My Awesome Room" maxlength="50">
            </div>
            <div class="form-row">
              <label class="form-label">Map</label>
              <select id="createRoomMap" class="form-select">
                <option value="">Loading maps...</option>
              </select>
            </div>
            <div class="form-row">
              <label class="form-label">Max Players: <span id="maxPlayersValue">8</span></label>
              <input type="range" id="createRoomMaxPlayers" class="form-slider" min="2" max="16" value="8">
            </div>
            <div class="form-row">
              <label class="form-checkbox-label">
                <input type="checkbox" id="createRoomPrivate" class="form-checkbox">
                <span class="form-checkbox-text">Private Room</span>
              </label>
            </div>
            <div class="form-row">
              <button id="createRoomButton" class="create-room-button">Create Room</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Debug Admin Panel -->
  <div id="debugPanel" class="debug-panel hidden">
    <div class="debug-header">
      <span class="debug-title">Debug</span>
      <button id="debugToggle" class="debug-toggle">âˆ’</button>
    </div>
    <div id="debugContent" class="debug-content">
      
      <!-- Player Controls -->
      <div class="debug-section">
        <h4>Player Controls</h4>
        <div class="debug-row">
          <label>Upgrade Points:</label>
          <input type="number" id="debugUpgradePoints" min="0" max="50" value="1">
          <button id="debugGivePoints" class="debug-btn">Give</button>
        </div>
        <div class="debug-row">
          <label>Laps:</label>
          <input type="number" id="debugLaps" min="0" max="100" value="0">
          <button id="debugSetLaps" class="debug-btn">Set</button>
        </div>
        <div class="debug-row">
          <label>Health:</label>
          <input type="range" id="debugHealth" min="0" max="100" value="100" class="debug-slider">
          <span id="debugHealthValue">100</span>
          <button id="debugSetHealth" class="debug-btn">Set</button>
        </div>
      </div>

      <!-- Position Controls -->
      <div class="debug-section">
        <h4>Position & State</h4>
        <div class="debug-row">
          <button id="debugResetPosition" class="debug-btn">Reset to Start</button>
          <button id="debugToggleGodMode" class="debug-btn" data-active="false">God Mode: OFF</button>
        </div>
      </div>

      <!-- Ability Controls -->
      <div class="debug-section">
        <h4>Abilities</h4>
        <div class="debug-row">
          <button id="debugResetAbility" class="debug-btn">Reset Cooldown</button>
          <button id="debugForceAbility" class="debug-btn">Force Activate</button>
        </div>
      </div>

      <!-- Stats Controls -->
      <div class="debug-section">
        <h4>Car Stats</h4>
        <div class="debug-row">
          <label>Max Health:</label>
          <input type="range" id="debugMaxHealth" min="1" max="200" value="20" class="debug-slider">
          <span id="debugMaxHealthValue">20</span>
        </div>
        <div class="debug-row">
          <label>Speed:</label>
          <input type="range" id="debugSpeed" min="0.001" max="1" step="0.001" value="0.1" class="debug-slider">
          <span id="debugSpeedValue">0.1</span>
        </div>
        <div class="debug-row">
          <label>Regen:</label>
          <input type="range" id="debugRegen" min="0" max="5" step="0.01" value="0.1" class="debug-slider">
          <span id="debugRegenValue">0.1</span>
        </div>
        <button id="debugSetStats" class="debug-btn full-width">Apply Stats</button>
      </div>

      <!-- Quick Actions -->
      <div class="debug-section">
        <h4>Quick Actions</h4>
        <div class="debug-row">
          <button id="debugResetUpgrades" class="debug-btn danger" onclick="return confirm('Reset all upgrades?')">Reset Upgrades</button>
          <button id="debugGetPlayerData" class="debug-btn">Refresh Data</button>
        </div>
      </div>

      <!-- Player Data Display -->
      <div class="debug-section">
        <h4>Player Data</h4>
        <div id="debugPlayerData" class="debug-data">
          Click "Refresh Data" to load player information
        </div>
      </div>

  </div>
  </div>

  <!-- Map Editor Overlay -->
  <div id="mapEditorContainer" class="map-editor-container hidden">
    <div class="map-editor-sidebar">
      <select id="mapSelect"></select>
      <button id="applyMapData">Apply JSON</button>
      <button id="downloadMapData">Download JSON</button>
      <textarea id="mapDataInput" class="map-editor-text"></textarea>
    </div>
    <canvas id="mapEditorCanvas" class="map-editor-canvas"></canvas>
  </div>

  <script src="client.js"></script>
  <script src="mapEditor.js"></script>
</body>
</html>